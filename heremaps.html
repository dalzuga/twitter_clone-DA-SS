<!DOCTYPE html>

<html>

<head>
    <title>Dan and Sravanthi's Twitter Clone Adventure - HERE MAPS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- CSS style sheet -->
    <link rel="stylesheet" href="reset.css">
    <!-- CSS style sheet -->

    <!-- Fav Icon -->
    <link rel="shortcut icon" type="image/png" href="leaf_960_720.png">
    <!-- Fav Icon -->

    <script src="http://js.api.here.com/v3/3.0/mapsjs-core.js" type="text/javascript" charset="utf-8"></script>
    <script src="http://js.api.here.com/v3/3.0/mapsjs-service.js" type="text/javascript" charset="utf-8"></script>
    <script src="http://js.api.here.com/v3/3.0/mapsjs-ui.js" type="text/javascript" charset="utf-8"></script>
    <link rel="stylesheet" type="text/css" href="http://js.api.here.com/v3/3.0/mapsjs-ui.css" />
    <script type="text/javascript" charset="UTF-8" src="https://js.api.here.com/v3/3.0/mapsjs-mapevents.js"></script>
</head>

<body>
    <div style="width: 100%; height: 100%; position: absolute;" id="mapContainer">
        <script>
            var platform = new H.service.Platform({
                'app_id': '0k8PCTGBMgCgWqe8jEtD'
                , 'app_code': 'B8WmKUK_E00MrrBNgI_gbQ'
            });


            // Get the default map types from the Platform object:
            var defaultLayers = platform.createDefaultLayers();

            // Instantiate the map:
            var map = new H.Map(
                document.getElementById('mapContainer')
                , defaultLayers.normal.map, {
                    zoom: 16
                    , center: {
                        lng: -122.39972
                        , lat: 37.79202
                    }
                });

            // Enable map events, like "contextmenu"
            var behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));

            // Retrieve the target element for the map:
            var targetElement = document.getElementById('mapContainer');

            // Create the default UI:
            var ui = H.ui.UI.createDefault(map, defaultLayers, 'en-US');

            // Create an info bubble object at a specific geographic location:
            var bubble = new H.ui.InfoBubble({
                lng: -122.39972
                , lat: 37.79202
            }, {
                content: '<b>Hello World!</b>'
            });

            // Add info bubble to the UI:
            ui.addBubble(bubble);

            var name = 'zoomrectangle'
            var control = new H.ui.ZoomRectangle;

            ui.addControl(name, control);

            var zoomrectangle = ui.getControl('zoomrectangle')

            zoomrectangle.setAlignment('right-middle');

            //            // Add 'Zoom in' context menu item
            //            map.addEventListener('contextmenu', function(e) {
            //            e.items.push(new H.util.ContextItem({
            //            label: 'Hello Holberton School!',
            //            callback: function() {
            //            map.setZoom(map.getZoom() + 1);
            //            }
            //            }));
            //            });

            //            map.addEventListener('tap', function (evt) {
            //            console.log('Clicked at ' + evt.currentPointer.viewportX + ',' +
            //            evt.currentPointer.viewportY);
            //            });

            //            function setUpClickListener(map) {
            //            map.addEventListener('tap', function (evt) {
            //            var coord = map.screenToGeo(evt.currentPointer.viewportX,
            //            evt.currentPointer.viewportY);
            //            console.log('Clicked at ' + Math.abs(coord.lat.toFixed(4)) +
            //            ((coord.lat > 0) ? 'N' : 'S') +
            //            ' ' + Math.abs(coord.lng.toFixed(4)) +
            //            ((coord.lng > 0) ? 'E' : 'W'));
            //            });
            //            }
            //            
            //            var callfunction = setUpClickListener(map);

            // Add map context menu event listener.
            map.addEventListener('contextmenu', onContextMenuRequested);

        function onContextMenuRequested(e) {
                // TODO: add the context menu item to get the result as shown below.

                var coordinates = map.screenToGeo(e.viewportX, e.viewportY);
                var gc = platform.getGeocodingService();
                var rgcParams = {
                    prox: Math.abs(coordinates.lat.toFixed(4)) +
                        ',-' + Math.abs(coordinates.lng.toFixed(4))
                    , mode: 'retrieveAddresses'
                    , maxresults: 1
                };
            var contextMenuEvent = new H.mapevents.ContextMenuEvent(e.viewportX, e.viewportY);

            contextMenuEvent.currentTarget = map;

            // Send the RGC request over.
            gc.reverseGeocode(rgcParams, function(result) {
            onRGCResult(result, contextMenuEvent);
            }, function(error) {
            console.log(error);
            });
        }
            /**
             * Processes reverse geocoder response and
             * adds a context menu item showing the associated address.
             */
            function onRGCResult(result, contextMenuEvent) {
                // var currentTarget = result;
                var addressLabel = result.Response.View[0].Result[0]; // TODO: find the response JSON path to get the address label.

                contextMenuEvent.items.push(new H.util.ContextItem({
                    label: addressLabel.Location.Address.Label
                , })); // TODO: add the address label as a context menu item.
                // Dispatch the context menu event again for all attached listeners to act with new added item(s).
                contextMenuEvent.currentTarget.dispatchEvent(contextMenuEvent);

            }

            // adjust map on resize
            window.addEventListener('resize', function () {
                map.getViewPort().resize();
            });
        </script>
    </div>
</body>

</html>